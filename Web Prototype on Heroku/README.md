# Setting Up a Web App on Heroku

This proof-of-concept project shows how a three-tier application (database, backend-server, and web page) can be hosted on Heroku, a PaaS (Platform as a Service). The application's functionality is simply to display a collection of physics formulas stored in a database.



### Overview of Technology and Software Components
1. **Framework**: Flask (lightweight Python web framework)
2. **Database**: PostgreSQL (Heroku's default database)
3. **Front-End User Inteface**: HTML generated by Jinja (Flask's templating engine)
4. **Deployment**: Heroku cloud platform



### Project Folder and File Structure

The following collection of folders and files (along with the programs installed to support them) comprise the application:

```
your_project/
│── venv/                # Virtual environment (ignored by Git)
│── app.py               # Flask application
│── models.py            # Database model
│── templates/           # Directory for HTML templates
│── templates/index.html # index.html template
│── requirements.txt     # File that holds Python package dependencies
│── Procfile             # Heroku startup instructions
│── .python-version      # Specifies Python version that Heroku will use
│── .gitignore           # List of folder and files for git to ignore
│── README.md            # Project documentation
```



## Set Up Your Local Development Environment

#### Create Project Directory

    (bash) (MacOS)
    
    mkdir [project_folder_name]
    cd [project_folder_name]



#### Create and Activate Virtual Environment

    (bash)
    
    python3 -m venv [venv_name]
    source ./[venv_name]/bin/activate



#### Install Python Dependencies (in *activated* venv)

    (venv)
    
    pip install flask
    pip install flask_sqlalchemy
    pip install psycopg2-binary
    pip install gunicorn

- **Flask**: Web framework
- **Flask-SQLAlchemy**: ORM (Object Relational Mapping) for database interactions
- **psycopg2-binary**: PostgreSQL adapter
- **gunicorn**: Production WSGI (Web Server Gateway Interface) server



#### Install Global Tools (with venv deactivated)

##### 1.  Install PostgreSQL (if not previously installed)

```
(bash)

brew install postgresql
```



##### 2.  Verify PostgreSQL Installation

```
(bash)

psql --version
```



##### 3.  Install Heroku CLI

```
(bash)

brew install heroku
```



##### 4.  Verify Heroku Installation

    (bash)
    
    heroku --version



##### 5.  Log in to Heroku

    (bash)
    
    heroku login

You will be prompted in the terminal to confirm that you want to login and then a web page login will open.



## Create Application Files

#### Create the following files with the venv deactivated.

##### 1.  Create models.py  

In the project directory (not in the venv), create a file named  `models.py` containing the following code. This file specifies the app's database model. 

    # models.py
    
    from flask_sqlalchemy import SQLAlchemy
    
    db = SQLAlchemy()
    
    class Formula(db.Model):
        id = db.Column(db.Integer, primary_key=True)
        formula_name = db.Column(db.String(100), nullable=False)
        latex = db.Column(db.Text, nullable=False)
        
        def __repr__(self):
            return f"<Formula {self.formula_name}>"

(These files can be created from scratch, or they can be downloaded from Github.)



##### 2.  Create app.py  

Create the Flask application file named  `app.py` containing the following code: 

    # app.py
    # Example: https://my-physics-web-app-5x-294f4a45978e.herokuapp.com/
    
    from flask import Flask, render_template
    from flask_sqlalchemy import SQLAlchemy
    import os
    from models import db, Formula  # Import from models.py (NO redefinition)
    
    app = Flask(__name__)
    
    # Connect to Heroku PostgreSQL database
    DATABASE_URL = os.environ.get("DATABASE_URL")
    
    # Fix for Heroku PostgreSQL URLs (Heroku uses `postgres://`, but SQLAlchemy requires `postgresql://`)
    if DATABASE_URL.startswith("postgres://"):
        DATABASE_URL = DATABASE_URL.replace("postgres://", "postgresql://", 1)
    
    app.config["SQLALCHEMY_DATABASE_URI"] = DATABASE_URL
    app.config["SQLALCHEMY_TRACK_MODIFICATIONS"] = False
    
    # Initialize db with app (NO reinitialization)
    db.init_app(app)
    
    @app.route("/")
    def home():
        formulas = Formula.query.all()  # Fetch all formulas from DB
        return render_template("index.html", formulas=formulas)
    
    if __name__ == "__main__":
        # Auto-create tables inside app context
        with app.app_context():
            db.create_all()
        app.run(debug=True)




##### 3.  Create templates/index.html  

Within the project folder, create a subfolder named templates. Then, within templates, create a file named  `index.html` containing the following code: 

    <!DOCTYPE html>
    <html>
    <head>
        <title>Physics Formulas</title>
        <script type="text/javascript" async src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
        <script type="text/javascript" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </head>
    <body>
        <h1>Physics Formulas</h1>
        <ul>
            {% for formula in formulas %}
                <li>{{ formula.formula_name }}: <span>$$ {{ formula.latex }} $$</span></li>
            {% endfor %}
        </ul>
        <script>
            MathJax.typeset(); // Renders MathJax formulas
        </script>
    </body>
    </html>



##### 4.  Create Procfile

Create a file named `Procfile` (no extension) and add the following contents, which tell Heroku what web package to run:

    web: gunicorn app:app



##### 5.  Create .python-version

Create a hidden file named `.python-version` with the following contents, which tells Heroku to run Python 3.11. This is an adjustment for one of the SQLAlchemy components (greenlet) which will not run correctly in version 3.13 of Python (the based version currently installed on my machine).

    python-3.11



##### 5.  Create requirements.txt  

With the Python venv running, use the following pip command to create a file named `requirements.txt`. This file lists the Python packages installed in the venv and will tell Heroku what packages to use. After creating the file, open it with the  `cat` command to confirm that it lists all of the packages installed in the venv. 

    pip freeze > requirements.txt
    
    cat requirements.txt



##### 6.  Create .gitignore  

Within the project folder, create a hidden file named  `.gitignore`. This tells git which folders and files not to track, and prevents these folders and files from being pushed to Heroku. 

    # Ignore virtual environment
    venv/
    
    # Ignore Python cache files
    __pycache__/
    *.pyc
    *.pyo
    
    # Ignore system-specific files
    .DS_Store
    .env
    
    # Ignore local database
    local.db



## Heroku Deployment

##### 1.  Initialize Git Repository

Local git tracking needs to be initialized *before* the Heroku application is created. Otherwise, the local repository will not be linked to the remote Heroku repository.

    git init
    git add .
    git commit -m "Initial commit"



##### 2.  Create Heroku App

    heroku create [application_name]

(The Heroku application name must begin and end with a letter.)

For future reference, add the URL that Heroku creates for the application as a comment in the app.py file.

##### Verify the application was created

    heroku apps



##### 3.  Push Code to Heroku

    git push heroku main



##### 4.  Add PostgreSQL to the Heroku Application

    heroku addons:create heroku-postgresql



##### 5.  Restart Heroku to connect PostgreSQL to the Heroku Application

    heroku restart



##### 6.  Initialize the Database on Heroku

Run Python in Heroku:

    heroku run python

In the Heroku Python shell, enter the following code manually to create the database, create a table, and create records in the table:

    (Heroku Python shell)
    
    # Create database and table.
    from app import db, app
    with app.app_context():
        db.create_all()from app 
        
    # Create records
    from app import db, app, Formula
    with app.app_context():
        db.create_all()
    
        # Add sample formulas
        formula1 = Formula(formula_name="Momentum", latex="\\vec{p} = m \\vec{v}")
        formula2 = Formula(formula_name="Newton's Second Law", latex="F = ma")
    
        db.session.add(formula1)
        db.session.add(formula2)
        db.session.commit()
    
    exit()



##### 7.  Verify the Table and Records Were Created

Open a Heroku PostgreSQL session:

    (bash)
    
    heroku pg:psql



At the psql prompt, run the following command to see if the table was created:

    (sql)
    
    \dt



The output should look like this:

    (sql)
    
    my-physics-web-app-6x::DATABASE=> \dt
                 List of relations
     Schema |  Name   | Type  |     Owner      
    --------+---------+-------+----------------
     public | formula | table | u1hgmm9m7ib0he
    (1 row)



At the psql prompt, run the following SELECT query:

    (sql)
    
    SELECT * FROM formula;



The output should look like this:

    (sql)
    
    my-physics-web-app-5x::DATABASE=> SELECT * FROM formula;
     id |    formula_name     |        latex        
    ----+---------------------+---------------------
      1 | Momentum            | \vec{p} = m \vec{v}
      2 | Newton's Second Law | F = ma
    (2 rows)



Quite the Heroku psql session:

    (sql)
    
    \q



### Open Your App

    heroku open --app [application_name]



### Troubleshooting

If the web page doesn't open and display the correct data, I have found ChatGPT is a pretty good resource for troubleshooting, the errors. Cut and paste the error into the ChatGPT and it will offer some useful tips.
